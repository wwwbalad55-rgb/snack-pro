<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Fast & Smooth âš¡</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap');

        * {
            box-sizing: border-box;
            margin: 0; padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation; /* Ø³Ø± Ø§Ù„Ø³Ù„Ø§Ø³Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }

        body {
            background: #1a1a1a;
            font-family: 'Cairo', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }

        .game-header { margin-bottom: 10px; text-align: center; }
        .score-board { 
            display: flex; gap: 20px; font-size: 18px; 
            background: #333; padding: 8px 20px; border-radius: 20px;
        }
        span { color: #f1c40f; font-weight: bold; }

        .game-area {
            position: relative;
            width: 320px; height: 320px;
            background: #000;
            border: 4px solid #444;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        canvas { display: block; width: 100%; height: 100%; }

        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 10;
        }
        .hidden { display: none !important; }

        button {
            font-family: 'Cairo', sans-serif;
            border: none; outline: none; cursor: pointer;
        }

        .menu-btn {
            background: #27ae60; color: white;
            padding: 10px 30px; font-size: 20px;
            border-radius: 50px; margin: 10px;
            box-shadow: 0 4px #1e8449;
        }
        .menu-btn:active { transform: translateY(3px); box-shadow: none; }

        .controls {
            margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 10px;
        }
        .row { display: flex; gap: 20px; }
        .c-btn {
            width: 65px; height: 65px;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            color: white; font-size: 24px;
            display: flex; justify-content: center; align-items: center;
        }
        .c-btn:active { background: rgba(255,255,255,0.3); }

    </style>
</head>
<body>

    <div class="game-header">
        <div class="score-board">
            <div>Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="score">0</span></div>
            <div>Ø§Ù„Ø£ÙØ¶Ù„: <span id="highScore">0</span></div>
        </div>
    </div>

    <div class="game-area">
        <canvas id="gameCanvas"></canvas>
        
        <div id="mainMenu" class="overlay">
            <h1>ğŸ Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†</h1>
            <p style="color:#aaa; font-size:14px; margin-bottom:10px">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</p>
            <button class="menu-btn" onclick="startGame('easy')">ğŸ˜Œ Ø³Ù‡Ù„</button>
            <button class="menu-btn" style="background:#c0392b; box-shadow:0 4px #922b21" onclick="startGame('hard')">ğŸ˜ˆ ØµØ¹Ø¨</button>
        </div>

        <div id="gameOverScreen" class="overlay hidden">
            <h2 style="color:red; font-size:30px">Ø®Ø³Ø±Øª! ğŸ’€</h2>
            <button class="menu-btn" onclick="showMenu()">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>
    </div>

    <div class="controls">
        <button class="c-btn" id="btnUp">â¬†ï¸</button>
        <div class="row">
            <button class="c-btn" id="btnLeft">â¬…ï¸</button>
            <button class="c-btn" id="btnDown">â¬‡ï¸</button>
            <button class="c-btn" id="btnRight">â¡ï¸</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª (Ø±ÙˆØ§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© ØµÙˆØª Ø®ÙÙŠÙ)
        const eatSound = new Audio('eat.mp3'); 
        const deadSound = new Audio('dead.mp3');

        // Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª
        const box = 20; 
        const canvasSize = 320;
        canvas.width = canvasSize;
        canvas.height = canvasSize;

        let snake = [];
        let food = {};
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let direction = '';
        let nextDirection = '';
        let gameLoop;
        let isRunning = false;
        let gameSpeed = 100;

        // Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† (Ø§Ù„Ø®Ø±ÙŠØ·Ø©: ÙˆØ³Ø· + Ø²ÙˆØ§ÙŠØ§)
        let obstacles = [];

        document.getElementById('highScore').innerText = highScore;

        function showMenu() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        function startGame(difficulty) {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            // ğŸ› ï¸ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©: Ø§Ù„Ø²Ø§ÙˆÙŠØ© (Ø¨Ø¹ÙŠØ¯ Ø¹Ù† Ø§Ù„Ø¬Ø¯Ø§Ø±)
            snake = [{x: 4 * box, y: 4 * box}];
            direction = '';
            nextDirection = '';
            score = 0;
            document.getElementById('score').innerText = score;

            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
            buildMap();
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ø¹Ø§Ù…
            food = generateFood();
            
            // Ø§Ù„Ø³Ø±Ø¹Ø© (Ø¨Ø§Ù„Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ© - ÙƒÙ„ Ù…Ø§ Ù‚Ù„ Ø§Ù„Ø±Ù‚Ù… Ø²Ø§Ø¯Øª Ø§Ù„Ø³Ø±Ø¹Ø©)
            // Ø³Ù‡Ù„: 130ms (Ø³Ù„Ø³) | ØµØ¹Ø¨: 90ms (Ø³Ø±ÙŠØ¹)
            gameSpeed = (difficulty === 'easy') ? 130 : 90;

            isRunning = true;
            if(gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(draw, gameSpeed);
        }

        function buildMap() {
            obstacles = [];
            // Ø§Ù„Ø¬Ø¯Ø§Ø± Ø§Ù„ÙˆØ³Ø·ÙŠ
            for(let i=5; i<11; i++) obstacles.push({x: i*box, y: 8*box});
            
            // Ø§Ù„Ø²ÙˆØ§ÙŠØ§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠ)
            // ÙÙˆÙ‚ ÙŠØ³Ø§Ø±
            obstacles.push({x: 1*box, y: 1*box}, {x: 2*box, y: 1*box}, {x: 1*box, y: 2*box});
            // ÙÙˆÙ‚ ÙŠÙ…ÙŠÙ†
            obstacles.push({x: 14*box, y: 1*box}, {x: 13*box, y: 1*box}, {x: 14*box, y: 2*box});
            // ØªØ­Øª ÙŠØ³Ø§Ø±
            obstacles.push({x: 1*box, y: 14*box}, {x: 2*box, y: 14*box}, {x: 1*box, y: 13*box});
            // ØªØ­Øª ÙŠÙ…ÙŠÙ†
            obstacles.push({x: 14*box, y: 14*box}, {x: 13*box, y: 14*box}, {x: 14*box, y: 13*box});
        }

        function draw() {
            if (nextDirection) direction = nextDirection;

            // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©
            ctx.fillStyle = "#111"; // Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚ Ù„ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‡Ø¬ Ø§Ù„Ø´Ø§Ø´Ø©
            ctx.fillRect(0, 0, canvasSize, canvasSize);

            // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
            ctx.fillStyle = "#c0392b";
            for(let obs of obstacles) {
                ctx.fillRect(obs.x, obs.y, box-1, box-1);
            }

            // Ø±Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…
            ctx.font = "20px Arial";
            ctx.textAlign = "center"; ctx.textBaseline = "middle";
            ctx.fillText("ğŸ", food.x + box/2, food.y + box/2 + 2);

            // Ø±Ø³Ù… Ø§Ù„Ø­ÙŠØ©
            for(let i=0; i<snake.length; i++){
                // Ø§Ù„Ø±Ø£Ø³ Ø£Ø¨ÙŠØ¶ØŒ Ø§Ù„Ø¬Ø³Ù… Ø£Ø®Ø¶Ø±
                ctx.fillStyle = (i===0) ? "#fff" : "#2ecc71";
                ctx.fillRect(snake[i].x, snake[i].y, box-1, box-1);
            }

            if(direction == "") return; // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©

            // Ø§Ù„Ø­Ø±ÙƒØ©
            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if(direction == "LEFT") snakeX -= box;
            if(direction == "UP") snakeY -= box;
            if(direction == "RIGHT") snakeX += box;
            if(direction == "DOWN") snakeY += box;

            // Ø¨ÙˆØ±ØªØ§Ù„ (Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…ÙØªÙˆØ­Ø©)
            if(snakeX < 0) snakeX = canvasSize - box;
            else if(snakeX >= canvasSize) snakeX = 0;
            if(snakeY < 0) snakeY = canvasSize - box;
            else if(snakeY >= canvasSize) snakeY = 0;

            // Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ù†ÙØ³ Ø£Ùˆ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
            if(collision(snakeX, snakeY)) {
                gameOver();
                return;
            }

            // Ø§Ù„Ø£ÙƒÙ„
            if(snakeX == food.x && snakeY == food.y){
                score++;
                document.getElementById('score').innerText = score;
                eatSound.currentTime = 0; eatSound.play().catch(()=>{}); // ØªØ¬Ø§Ù‡Ù„ Ø®Ø·Ø£ Ø§Ù„ØµÙˆØª Ø§Ø°Ø§ Ù…Ø§ Ø§Ø´ØªØºÙ„
                food = generateFood();
            } else {
                snake.pop();
            }

            let newHead = {x: snakeX, y: snakeY};
            snake.unshift(newHead);
        }

        function collision(x, y) {
            // Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø¬Ø³Ù…
            for(let i=0; i<snake.length; i++){
                if(x == snake[i].x && y == snake[i].y) return true;
            }
            // Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
            for(let obs of obstacles){
                if(x == obs.x && y == obs.y) return true;
            }
            return false;
        }

        function generateFood() {
            let newFood;
            while(true) {
                newFood = {
                    x: Math.floor(Math.random() * (canvasSize/box)) * box,
                    y: Math.floor(Math.random() * (canvasSize/box)) * box
                };
                // Ø§Ù„ØªØ£ÙƒØ¯ Ø§Ù† Ø§Ù„Ø§ÙƒÙ„ Ù…Ùˆ ÙÙˆÙ‚ Ø§Ù„Ø­ÙŠØ© ÙˆÙ„Ø§ Ø§Ù„Ø¬Ø¯Ø§Ø±
                if(!collision(newFood.x, newFood.y)) break;
            }
            return newFood;
        }

        function gameOver() {
            isRunning = false;
            clearInterval(gameLoop);
            deadSound.play().catch(()=>{});
            if(score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
            }
            document.getElementById('highScore').innerText = highScore;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        // ØªØ­ÙƒÙ… (Ù„Ù…Ø³ Ø³Ø±ÙŠØ¹)
        function handleInput(dir) {
            if(!isRunning) return;
            if(dir == "LEFT" && direction != "RIGHT") nextDirection = "LEFT";
            if(dir == "UP" && direction != "DOWN") nextDirection = "UP";
            if(dir == "RIGHT" && direction != "LEFT") nextDirection = "RIGHT";
            if(dir == "DOWN" && direction != "UP") nextDirection = "DOWN";
        }

        // Ø±Ø¨Ø· Ø§Ù„Ø§Ø²Ø±Ø§Ø±
        document.getElementById('btnUp').onpointerdown = (e) => { e.preventDefault(); handleInput('UP'); };
        document.getElementById('btnDown').onpointerdown = (e) => { e.preventDefault(); handleInput('DOWN'); };
        document.getElementById('btnLeft').onpointerdown = (e) => { e.preventDefault(); handleInput('LEFT'); };
        document.getElementById('btnRight').onpointerdown = (e) => { e.preventDefault(); handleInput('RIGHT'); };

        // ÙƒÙŠØ¨ÙˆØ±Ø¯
        document.addEventListener('keydown', (e) => {
            if(e.keyCode == 37) handleInput('LEFT');
            if(e.keyCode == 38) handleInput('UP');
            if(e.keyCode == 39) handleInput('RIGHT');
            if(e.keyCode == 40) handleInput('DOWN');
        });

    </script>
</body>
</html>